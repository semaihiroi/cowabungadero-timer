<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="gifs/spr_heart.png" type="image/png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Deltarune Pomodoro Timer</title>
  <style>
    @font-face {
      font-family: 'Determination';
      src: url('fonts/DeterminationMonoWeb.woff') format('woff');
    }

    /*@import url('fonts/determination-mono.otf.woff2');*/

    @font-face {
      font-family: 'Ithaca';
      src: url('fonts/Bitrimus.ttf') format('truetype');
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Determination', monospace;
      background-color: black;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .grid-background-layer-1,
    .grid-background-layer-2 {
      position: absolute;
      top: 0;
      left: 0;
      width: 200%;
      height: 200%;
      background-image:
        repeating-linear-gradient(to bottom, rgba(70, 0, 70, 1) 0px, rgba(70, 0, 70, 1) 2px, transparent 2px, transparent 50px),
        repeating-linear-gradient(to right, rgba(70, 0, 70, 1) 0px, rgba(70, 0, 70, 1) 2px, transparent 2px, transparent 50px);
      animation: scroll-1 8s linear infinite;
      z-index: 1;
    }

    .grid-background-layer-2 {
      background-image:
        repeating-linear-gradient(to bottom, rgba(35, 0, 35, 1) 0px, rgba(35, 0, 35, 1) 2px, transparent 2px, transparent 50px),
        repeating-linear-gradient(to right, rgba(35, 0, 35, 1) 0px, rgba(35, 0, 35, 1) 2px, transparent 2px, transparent 50px);
      animation: scroll-2 8s linear infinite;
      z-index: 0;
    }

    @keyframes scroll-1 {
      from { transform: translateY(0px) translateX(0px); }
      to { transform: translateY(-100px) translateX(-100px); }
    }

    @keyframes scroll-2 {
      from { transform: translateY(0px) translateX(0px); }
      to { transform: translateY(100px) translateX(100px); }
    }

    .container {
      z-index: 2;
      text-align: center;
    }

    .timer {
      font-size: 5em;
      margin-bottom: 1em;
      background-color: black;
      border: 4px solid green;
      padding-top: 1em;
      padding-bottom: 1em;
      padding-left: 0.3em;
      padding-right: 0.2em;
      display: inline-block;
      color: #0f0;
      user-select: none;
      letter-spacing: 0.1em;
    }

    #phaseBox {
      font-family: 'Ithaca', monospace;
      text-transform: uppercase;
      font-size: 2.2em;
      color: white;
      border: 2px solid cyan;
      padding: 0.6em 1em;
      width: 280px;
      /*margin: 0 auto 1em auto;*/
      user-select: none;
      background-color: #121212;
      text-align: center;
      border-radius: 0px;
    }

    #controls {
      width: 280px;
      /*margin: 0 auto;*/
      text-align: match-parent;
      display: flex;
      justify-content: center;
      /*gap: 1em;*/
      /*margin-bottom: 1em;*/
      user-select: none;
    }

    #startBtn, #skipBtn {
      font-family: 'Ithaca', monospace;
      text-transform: uppercase;
      font-size: 1.1em;
      padding: 1.25em 2em;
      flex-grow: 1;
      border: 2px solid cyan;
      background-color: black;
      color: orange;
      cursor: pointer;
      border-radius: 0px;
      user-select: none;
      transition: background-color 0.2s, color 0.2s;
    }

    #startBtn:hover, #skipBtn:hover {
      background-color: white;
      color: black;
    }

    .dialogue-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: black;
      border-top: 2px solid rgb(48, 38, 51);
      padding: 1em;
      font-size: 2.5em;
      font-family: 'Determination', monospace;
      line-height: 1.4em;
      display: flex;
      /*justify-content: space-between;*/
      align-items: flex-start;
      z-index: 3;
      user-select: none;
    }

    .dialogue-portrait {
      height: 128px;
      object-fit: fill;
      /*border: 2px solid white;*/
    }

    .dialogue-text {
      color: white;
      padding-right: 1em;
      padding-left: 3em;
      max-width: 85%;
      min-height: 3em;
      white-space: pre-wrap;
    }

    /* Left side GIF container */
    .left-gif-container {
      position: absolute;
      top: 20%;
      left: 3%;
      display: flex;
      flex-direction: column;
      gap: 3em;
      z-index: 2;
      user-select: none;
    }

    .left-gif-container img {
      width: max-content;
      height: auto;
      /*border: 2px solid white;
      border-radius: 4px;
      background-color: #121212;*/
    }

    /* Right side dynamic GIF */
    .right-gif-container {
      position: absolute;
      top: 20%;
      right: 5%;
      width: 180px;
      height: 180px;
      /*border: 2px solid white;
      border-radius: 6px;
      background-color: #121212;*/
      z-index: 2;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .right-gif-container img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 4px;
    }
    
  </style>
</head>
<body>
  <div class="grid-background-layer-1"></div>
  <div class="grid-background-layer-2"></div>
  <audio id="musicPlayer" preload="auto"></audio>

  <!-- Left side dynamic GIFs for Kris, Susie, and Ralsei -->
  <div class="left-gif-container">
    <img id="gifKris" src="kris_work.gif" alt="Kris GIF" title="Kris" />
    <img id="gifSusie" src="susie_work.gif" alt="Susie GIF" title="Susie" />
    <img id="gifRalsei" src="ralsei_work.gif" alt="Ralsei GIF" title="Ralsei" />
  </div>

  <!-- Right side dynamic GIF -->
  <div class="right-gif-container">
    <img id="gifRight" src="spamton_work.gif" alt="Right side character GIF" />
  </div>

  <div class="container">
    <div class="timer" id="timer">25:00</div>
    <div id="phaseBox">Phase: Work | Next: Break</div>
    <div id="controls">
        <button onclick="toggleTimer()" id="startBtn">Start</button>
        <button onclick="skipPhase()" id="skipBtn">Skip</button>
    </div>
  </div>

  <div class="dialogue-bar">
    <img src="spamton.png" class="dialogue-portrait" id="portrait" alt="Character portrait"/>
    <div class="dialogue-text" id="quoteBox"></div>
  </div>

  <audio id="alarmSound" src="sounds/snd_badexplosion.wav" preload="auto"></audio>
  <audio id="clickSound" src="sounds/snd_select.wav" preload="auto"></audio>

  <script>
    // Timing constants
    const workDuration = 25 * 60;
    const shortBreak = 5 * 60;
    const longBreak = 15 * 60;
    const cyclesBeforeLong = 4;

    // State variables
    let timeLeft = workDuration;
    let timer = null;
    let phase = 'Work'; // 'Work', 'Break', 'LongBreak'
    let cycleCount = 0;
    let isRunning = false;

    // DOM elements
    const timerDisplay = document.getElementById('timer');
    const phaseBox = document.getElementById('phaseBox');
    const startBtn = document.getElementById('startBtn');
    const skipBtn = document.getElementById('skipBtn');
    const quoteBox = document.getElementById('quoteBox');
    const portrait = document.getElementById('portrait');
    const alarm = document.getElementById('alarmSound');
    const click = document.getElementById('clickSound');

    const gifKris = document.getElementById('gifKris');
    const gifSusie = document.getElementById('gifSusie');
    const gifRalsei = document.getElementById('gifRalsei');
    const gifRight = document.getElementById('gifRight');

    // Quotes and portraits for characters
    const spamtonQuotes = [
      "Make the DEAL of your LIFE!",
      "WORKING? That's the [Hot New Thing]!",
      "You can't have [[Success]] without [[Pain]]!"
    ];

    const tennaQuotes = [
      "Your DESTINY is only a heartbeat away.",
      "JUST BELIEVE in the [Cosmic Groove] and DANCE!",
      "You're not alone, my STARLIGHT."
    ];

    const torielQuotes = [
      "Take a break, dear. You've worked hard.",
      "Don't forget to rest and eat something wholesome.",
      "Patience is the key to success, my child."
    ];

    // Character data for right side GIF and portrait
    const characters = [
      { name: 'Spamton', quotes: spamtonQuotes, imgPortrait: 'gifs/spamton.webp', imgGifWork: 'gifs/spamton_work.webp', imgGifBreak: 'spamton_break.gif' },
      { name: 'Tenna', quotes: tennaQuotes, imgPortrait: 'gifs/tenna.png', imgGifWork: 'gifs/tenna_work.gif', imgGifBreak: 'tenna_break.gif' },
      { name: 'Toriel', quotes: torielQuotes, imgPortrait: 'gifs/toriel.webp', imgGifWork: 'toriel_work.gif', imgGifBreak: 'toriel_break.gif' },
    ];

    // Left side GIFs for phases
    const leftGifs = {
      Work: {
        Kris: 'gifs/kris_work.gif',
        Susie: 'gifs/susie_work.gif',
        Ralsei: 'gifs/ralsei_work.gif',
      },
      Break: {
        Kris: 'gifs/kris_break.webp',
        Susie: 'gifs/susie_break.webp',
        Ralsei: 'gifs/ralsei_break.webp',
      },
      LongBreak: {
        Kris: 'gifs/kris_longbreak.webp',
        Susie: 'gifs/susie_longbreak.webp',
        Ralsei: 'gifs/ralsei_longbreak.webp',
      }
    };

    // Break icon for portrait and right gif when on break
    const breakIconPortrait = 'break-icon.png';
    const breakIconGif = 'break_right.gif';

    // Current chosen character for right side
    let currentCharacter = characters[0];

    // Helper: pick random item from array
    function randomChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function typeQuote(text, element) {
      element.textContent = '';
      let i = 0;
      const interval = setInterval(() => {
        if (i < text.length) {
          element.textContent += text[i++];
        } else {
          clearInterval(interval);
        }
      }, 30);
    }

    function updateQuoteBox() {
      if (phase === 'Work') {
        // Pick a random character and quote
        currentCharacter = randomChoice(characters);
        portrait.src = currentCharacter.imgPortrait;
        gifRight.src = currentCharacter.imgGifWork;
        const quote = randomChoice(currentCharacter.quotes);
        typeQuote(quote, quoteBox);
      } else {
        portrait.src = breakIconPortrait;
        gifRight.src = breakIconGif;
        typeQuote('Break time! ✨', quoteBox);
      }
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
      const seconds = (timeLeft % 60).toString().padStart(2, '0');
      timerDisplay.textContent = `${minutes}:${seconds}`;
    }

    function updatePhaseBox() {
      let nextPhase = '';
      if (phase === 'Work') {
        nextPhase = 'Break';
      } else if (phase === 'Break') {
        nextPhase = cycleCount >= cyclesBeforeLong ? 'Long Break' : 'Work';
      } else {
        nextPhase = 'Work';
      }
      phaseBox.textContent = `Phase: ${phase.replace('LongBreak','Long Break')} | Next: ${nextPhase}`;
    }

    function updateLeftGifs() {
      gifKris.src = leftGifs[phase]?.Kris || 'kris_work.gif';
      gifSusie.src = leftGifs[phase]?.Susie || 'susie_work.gif';
      gifRalsei.src = leftGifs[phase]?.Ralsei || 'ralsei_work.gif';
    }

    function updateAllVisuals() {
      updateTimerDisplay();
      updatePhaseBox();
      updateQuoteBox();
      updateLeftGifs();
    }

    function switchPhase() {
      if (phase === 'Work') {
        cycleCount++;
        if (cycleCount >= cyclesBeforeLong) {
          phase = 'LongBreak';
          timeLeft = longBreak;
          cycleCount = 0;
        } else {
          phase = 'Break';
          timeLeft = shortBreak;
        }
      } else {
        phase = 'Work';
        timeLeft = workDuration;
      }
      updateAllVisuals();
      alarm.play();
    }

    function skipPhase() {
      click.play();
      switchPhase();
    }

    function toggleTimer() {
      click.play();
      if (isRunning) {
        clearInterval(timer);
        isRunning = false;
        startBtn.textContent = 'Start';
      } else {
        isRunning = true;
        startBtn.textContent = 'Pause';
        timer = setInterval(() => {
          if (timeLeft > 0) {
            timeLeft--;
            updateTimerDisplay();
          } else {
            switchPhase();
          }
        }, 1000);
      }
    }

      // Initialize
      
    // Initial setup
    updateAllVisuals();

    
  </script>
</body>
</html>
